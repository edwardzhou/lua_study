日活跃用户:当日用户登陆过算活跃用户.&nbsp&nbsp<br>
当日付费数:当天充值用户总数<br>
当日新增用户：当天新增注册用户数<br>
新增活跃比例：新增用户和活跃用户的百分比<br>
Arpu：充值总收入除充值总人数<br>
<%= form_tag("/admin/ddz_baobiaos/cx", method: "post") do %>
    <div class="field" align="center" xmlns="http://www.w3.org/1999/html">
      日期:
      <select name="date">
        <% @q_date.each do |date| %>
            <option value="<%= date %>" <%= "selected" if date ==@date %>><%= date %></option>
        <% end %> </select>


      <button id="button" type="submit">查询</button>
    </div>
    <table class="index_table index">
      <tr>
        <th class="sortable sorted-desc id"><%= @date %></th>
        <th class="sortable sorted-desc id">日新增用户</th>
        <th class="sortable sorted-desc id">日活跃用户</th>
        <th class="sortable sorted-desc id">新增活跃比</th>
        <th class="sortable sorted-desc id">日付费用户</th>
        <th class="sortable sorted-desc id">日充值金额</th>
        <th class="sortable sorted-desc id">Arpu</th>
        <th class="sortable sorted-desc id">日同时最高在线</th>
      </tr>
      <% i =1 %>
      <% @result.each do |data| %>
          <% key = data["date"][8, 2] %>
          <tr class="<%= i%2==0 ? "odd" : "even" %>">
            <td><%= key %>日</td>
            <td><%= @data["#{key}-add_day_user"] %></td>
            <td><%= @data["#{key}-huoyue_yonghu"] %></td>
            <td>
              <% if @data["#{key}-huoyue_yonghu"].to_i!=0 %>
                  <% unless @data["#{key}-add_day_user"].nil? %>
                      <% if (@data["#{key}-add_day_user"].to_f/@data["#{key}-huoyue_yonghu"]).to_s.length>5 %>
                          <% arp ="#{(@data["#{key}-add_day_user"].to_f/@data["#{key}-huoyue_yonghu"]).to_f * 100}" %>
                          <% arp = arp[0, 5] if arp.length>5 %>
                          <%= "#{arp}%" %>
                      <% else %>
                          <%= "#{(@data["#{key}-add_day_user"].to_f/@data["#{key}-huoyue_yonghu"])*100}%" %>
                      <% end %>
                  <% else %>
                      0
                  <% end %>
              <% end %>
              <%= 0 if @data["#{key}-huoyue_yonghu"].to_i==0 %>
            </td>
            <td><%= @data["#{key}-day_exp_user"] %></td>
            <td><%= @data["#{key}-total_day_money"] %></td>
            <td>
              <% if @data["#{key}-erpu"].to_s.length>5 %>
                  <%= @data["#{key}-erpu"].to_s[0, 4] %>
              <% else %>
                  <%= @data["#{key}-erpu"].to_s %>
              <% end %>

            </td>
            <td>
              <% if "#{@date}-#{key}"<"2014-06-25" %>
                  <%= "--" %>
              <% else %>
                  <%= @data["#{key}-day_max_online"] %></td>

              <% end %>
              </tr>
          <% i =i+1 %>
      <% end %>


      <tr class="<%= i%2==0 ? "odd" : "even" %>">
        <th>当月总数</th>
        <th>当月新增用户: <%= @month_add_count %></th>
        <th>当月活跃用户: <%= @month_huoyue_count %></th>
        <% if @month_huoyue_count.to_i!=0 %>
            <% lv = @month_add_count/@month_huoyue_count.to_f %>
            <% lv = lv.to_s[0, 5] if lv.to_s.length>5 %>
            <% lv = "#{(lv.to_f * 100).round(1)}%" %>

        <% else %>
            <% lv = 0%>
        <% end %>
        <th>当月新增活跃比: <%= lv %></th>
        <th>当月付费用户: <%= @month_chongzhi_user %></th>
        <th>当月充值金额: <%= @month_total_shouru.to_f.round(1) %></th>
        <th colspan="3" style="text-align:center;">当月Arpu:
          <% if @month_chongzhi_user.to_i!=0 %>
              <% if (@month_total_shouru.to_f/@month_chongzhi_user).to_s.length > 5 %>
                  <%= (@month_total_shouru.to_f/@month_chongzhi_user).to_s[0, 4] %>
              <% else %>
                  <%= (@month_total_shouru.to_f/@month_chongzhi_user) %>
              <% end %>
          <% else %>
              0
          <% end %></th>
      </tr>


      <tr class="<%= i%2==0 ? "odd" : "even" %>">
        <th>汇总明细</th>
        <th>累计总数: <%= @user_count %></th>
        <th>累计活跃用户数: <%= @all_huoyue_count %></th>
        <% if @all_huoyue_count.to_i!=0 %>
            <% lv = @user_count/@all_huoyue_count.to_f %>
            <% lv = lv.to_s[0, 5] if lv.to_s.length>5 %>
            <% lv = "#{lv.to_f * 100}" %>
            <% lv = lv.to_s[0,5] %>
            <% lv = "#{lv}%"%>
        <% else %>
            <% lv = 0%>
        <% end %>
        <th>累计新增活跃比: <%= lv %></th>
        <th>累计付费用户: <%= @all_chongzhi_yonghu %></th>


        <th>累计充值收入: <%= @all_chongzhi_shouru.to_i %></th>
        <th colspan="2" style="text-align:center;">总Arpu:
          <% if @all_chongzhi_yonghu.to_i !=0 %>
              <% if (@all_chongzhi_shouru.to_f/@all_chongzhi_yonghu).to_s.length >5 %>
                  <%= (@all_chongzhi_shouru.to_f/@all_chongzhi_yonghu).to_s[0, 4] %>
              <% else %>
                  <%= (@all_chongzhi_shouru.to_f/@all_chongzhi_yonghu) %>
              <% end %>
          <% else %>
              0
          <% end %>

        </th>
      </tr>


    </table>
<% end %>
